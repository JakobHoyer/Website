<!doctype html>
<html lang="da">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Min musik – SoundCloud</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;max-width:1080px;margin:24px auto;padding:0 16px}
  header{display:flex;gap:16px;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid #eee}
  a{text-decoration:none;color:inherit}
  .grid{display:grid;gap:18px;grid-template-columns:1fr}
  @media (min-width:720px){.grid{grid-template-columns:repeat(3,1fr)}}
  .card{border:1px solid #e6e6e6;border-radius:14px;overflow:hidden;background:#fff;display:flex;flex-direction:column}
  .cover{aspect-ratio:1/1;background:#f2f2f2;display:block;width:100%;object-fit:cover}
  .content{padding:12px}
  .title{font-weight:600;margin:0 0 4px 0}
  .meta{color:#666;font-size:.9rem}
  .pill{display:inline-block;background:#f4f4f4;border:1px solid #e6e6e6;padding:2px 8px;border-radius:999px;font-size:.8rem;margin-right:6px}
  .empty{color:#666}
</style>

<header>
  <a href="/"><strong>Min side</strong></a>
  <nav>
    <a href="/">Forside</a> · <a href="/apps/">Apps</a> · <a href="/music/">Musik</a>
  </nav>
</header>

<h1>Musik</h1>
<p class="meta">Mine SoundCloud-udgivelser. Klik for at åbne på SoundCloud.</p>

<div id="list" class="grid"></div>
<p id="empty" class="empty" style="display:none;">Ingen tracks endnu. Tilføj dem i <code>/music/tracks.json</code>.</p>

<script>
(async () => {
  let tracks = [];
  try {
    const res = await fetch('/music/tracks.json', { cache: 'no-store' });
    if (res.ok) tracks = await res.json();
  } catch {}

  const el = document.getElementById('list');
  const empty = document.getElementById('empty');

  if (!Array.isArray(tracks) || tracks.length === 0) {
    empty.style.display = 'block';
    return;
  }

  // Hjælpefunktion: hent cover via SoundCloud oEmbed, hvis der ikke er coverURL i manifestet
  async function fetchOEmbedThumb(url){
    try {
      const r = await fetch(`https://soundcloud.com/oembed?format=json&url=${encodeURIComponent(url)}`);
      if (!r.ok) return null;
      const data = await r.json();
      // artwork_url findes ikke altid i oEmbed; men thumbnail_url gør typisk
      return data.thumbnail_url || null;
    } catch { return null; }
  }

  // Byg kort
  for (const t of tracks) {
    let cover = t.cover || null;
    if (!cover && t.url) {
      cover = await fetchOEmbedThumb(t.url);
    }
    const img = cover ? `<img class="cover" alt="" src="${cover}">`
                      : `<div class="cover"></div>`;

    el.insertAdjacentHTML('beforeend', `
      <a class="card" href="${t.url}" target="_blank" rel="noopener">
        ${img}
        <div class="content">
          <div class="title">${t.title || 'Untitled'}</div>
          <div class="meta">
            ${t.artist ? `<span class="pill">${t.artist}</span>` : ''}
            ${t.tag ? `<span class="pill">${t.tag}</span>` : ''}
          </div>
        </div>
      </a>
    `);
  }
})();
</script>
</html>
